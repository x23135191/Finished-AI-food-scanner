<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Food Finder</title>
<style>
  body {
    margin: 0;
    background: radial-gradient(circle at top left, #0d0d0d, #1a1a1a);
    color: #fff;
    font-family: 'Poppins', sans-serif;
    text-align: center;
    overflow-x: hidden;
  }
  header {
    font-size: 2em;
    font-weight: 600;
    padding: 20px;
    background: linear-gradient(90deg, #ff4b2b, #ff416c);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  #map {
    height: 400px;
    width: 80%;
    margin: 20px auto;
    border-radius: 16px;
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
  }
  #upload-container {
    margin: 20px;
  }
  #result {
    margin: 20px;
    font-size: 1.2em;
  }
  #progressBarContainer {
    width: 60%;
    margin: 10px auto;
    background: #222;
    border-radius: 10px;
    overflow: hidden;
    height: 15px;
    display: none;
  }
  #progressBar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #ff4b2b, #ff416c);
    transition: width 0.3s ease;
  }
  #foodGallery {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    margin-top: 30px;
  }
  #foodGallery img {
    width: 200px;
    height: 200px;
    object-fit: cover;
    border-radius: 16px;
    box-shadow: 0 0 20px rgba(255,255,255,0.15);
    transition: transform 0.3s ease;
  }
  #foodGallery img:hover {
    transform: scale(1.05);
  }
  #aiSuggestion {
    margin: 20px auto;
    width: 80%;
    font-size: 1.1em;
    color: #ffd1dc;
  }
</style>
</head>
<body>
  <header>üçΩÔ∏è AI Food Finder</header>
  <div id="upload-container">
    <input type="file" id="fileInput" accept="image/*">
  </div>
  <div id="result">Upload a food image to get restaurant recommendations</div>
  <div id="progressBarContainer"><div id="progressBar"></div></div>
  <div id="map"></div>
  <div id="aiSuggestion"></div>
  <div id="foodGallery"></div>

<script>
const GEMINI_API_KEY = "AIzaSyCABqWaR4pjHwPBDknEdnzlSIgk0ubhuLw";
const GOOGLE_MAPS_API_KEY = "AIzaSyCABqWaR4pjHwPBDknEdnzlSIgk0ubhuLw";
let map, placesService, userLocation = null;

function initMap() {
  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: 51.5074, lng: -0.1278 },
    zoom: 12,
    styles: [{elementType:"geometry",stylers:[{color:"#1a1a1a"}]},{elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#333333"}]}]
  });
  placesService = new google.maps.places.PlacesService(map);
}

document.getElementById("fileInput").addEventListener("change", async (event) => {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = async () => {
    const base64Image = reader.result.split(',')[1];
    await analyzeWithGemini(base64Image);
  };
  reader.readAsDataURL(file);
});

function showProgress() {
  const container = document.getElementById("progressBarContainer");
  const bar = document.getElementById("progressBar");
  container.style.display = "block";
  bar.style.width = "0%";
  let progress = 0;
  const interval = setInterval(() => {
    progress += 10;
    bar.style.width = progress + "%";
    if (progress >= 90) clearInterval(interval);
  }, 300);
  return interval;
}

function hideProgress(interval) {
  const bar = document.getElementById("progressBar");
  const container = document.getElementById("progressBarContainer");
  clearInterval(interval);
  bar.style.width = "100%";
  setTimeout(() => container.style.display = "none", 600);
}

async function analyzeWithGemini(base64Image) {
  const resultDiv = document.getElementById("result");
  const suggestionDiv = document.getElementById("aiSuggestion");
  resultDiv.textContent = "Analyzing food image...";
  suggestionDiv.textContent = "";
  const progressInterval = showProgress();
  try {
    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({
        contents: [{
          parts: [
            { text: "You are a food recognition expert. Identify the specific dish or cuisine in this image and describe it concisely. Focus only on the food, not utensils or background." },
            { inline_data: { mime_type: "image/jpeg", data: base64Image } }
          ]
        }]
      })
    });
    const data = await response.json();
    const text = data?.candidates?.[0]?.content?.parts?.[0]?.text || "No food detected.";
    resultDiv.textContent = text;
    suggestionDiv.textContent = "Finding nearby restaurants...";
    const dish = extractDishName(text);
    await findNearbyRestaurants(dish);
    generateAIImages(dish);
  } catch (err) {
    resultDiv.textContent = "Error analyzing image.";
    console.error(err);
  } finally {
    hideProgress(progressInterval);
  }
}

function extractDishName(description) {
  const match = description.match(/(?:dish|is|called|features|showing)\s([\w\s]+)/i);
  return match ? match[1].trim() : "restaurant";
}

function findNearbyRestaurants(keyword) {
  return new Promise((resolve) => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition((pos) => {
        userLocation = { lat: pos.coords.latitude, lng: pos.coords.longitude };
        map.setCenter(userLocation);
        const req = { location: userLocation, radius: 5000, type: "restaurant", keyword };
        placesService.nearbySearch(req, (results, status) => {
          if (status === google.maps.places.PlacesServiceStatus.OK && results.length) {
            results.forEach((place) => new google.maps.Marker({ map, position: place.geometry.location, title: place.name }));
            document.getElementById("aiSuggestion").textContent = `Here are restaurants near you serving ${keyword}.`;
          } else {
            document.getElementById("aiSuggestion").textContent = "No nearby restaurants found.";
          }
          resolve();
        });
      }, () => {
        document.getElementById("aiSuggestion").textContent = "Unable to access location.";
        resolve();
      });
    } else {
      document.getElementById("aiSuggestion").textContent = "Geolocation not supported.";
      resolve();
    }
  });
}

function generateAIImages(keyword) {
  const gallery = document.getElementById("foodGallery");
  gallery.innerHTML = "";
  for (let i = 0; i < 5; i++) {
    const img = document.createElement("img");
    const prompt = `high quality, realistic photo of ${keyword}, professional food photography, restaurant plating, diverse styles`;
    img.src = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?${Math.random()}`;
    gallery.appendChild(img);
  }
}
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places&callback=initMap"></script>
</body>
</html>

