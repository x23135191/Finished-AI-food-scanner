<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Food Finder</title>
<style>
  body {
    margin: 0;
    background: radial-gradient(circle at top left, #0d0d0d, #1a1a1a);
    color: #fff;
    font-family: 'Poppins', sans-serif;
    text-align: center;
    overflow-x: hidden;
  }
  header {
    font-size: 2em;
    font-weight: 600;
    padding: 20px;
    background: linear-gradient(90deg, #ff4b2b, #ff416c);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  #map {
    height: 400px;
    width: 80%;
    margin: 20px auto;
    border-radius: 16px;
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
  }
  #upload-container {
    margin: 20px;
  }
  #result {
    margin: 20px;
    font-size: 1.2em;
  }
  #foodGallery {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    margin-top: 30px;
  }
  #foodGallery img {
    width: 200px;
    height: 200px;
    object-fit: cover;
    border-radius: 16px;
    box-shadow: 0 0 20px rgba(255,255,255,0.15);
    transition: transform 0.3s ease;
  }
  #foodGallery img:hover {
    transform: scale(1.05);
  }
  #aiSuggestion {
    margin: 20px auto;
    width: 80%;
    font-size: 1.1em;
    color: #ffd1dc;
  }
</style>
</head>
<body>
  <header>üçΩÔ∏è AI Food Finder</header>
  <div id="upload-container">
    <input type="file" id="fileInput" accept="image/*">
  </div>
  <div id="result">Upload a food image to get restaurant recommendations</div>
  <div id="map"></div>
  <div id="aiSuggestion"></div>
  <div id="foodGallery"></div>

<script>
const GEMINI_API_KEY = "AIzaSyCABqWaR4pjHwPBDknEdnzlSIgk0ubhuLw";
const GOOGLE_MAPS_API_KEY = "AIzaSyCABqWaR4pjHwPBDknEdnzlSIgk0ubhuLw";
let map, placesService, userLocation = null;

function initMap() {
  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: 51.5074, lng: -0.1278 },
    zoom: 12,
    styles: [
      {elementType:"geometry",stylers:[{color:"#1a1a1a"}]},
      {elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},
      {featureType:"poi",stylers:[{visibility:"off"}]},
      {featureType:"road",elementType:"geometry",stylers:[{color:"#333333"}]}
    ]
  });
  placesService = new google.maps.places.PlacesService(map);
}

document.getElementById("fileInput").addEventListener("change", async (event) => {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = async () => {
    const base64Image = reader.result.split(',')[1];
    await analyzeWithGemini(base64Image);
  };
  reader.readAsDataURL(file);
});

async function analyzeWithGemini(base64Image) {
  const resultDiv = document.getElementById("result");
  const suggestionDiv = document.getElementById("aiSuggestion");
  resultDiv.textContent = "Analyzing food image...";
  suggestionDiv.textContent = "";
  try {
    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`,
      {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
          contents: [{
            parts: [
              {
                text: `You are a culinary AI expert. Analyze this image and identify only the food item or dish shown, ignoring utensils, tableware, hands, or background objects. 
                Describe the dish briefly (e.g., name, cuisine, and main ingredients).`
              },
              { inline_data: { mime_type: "image/jpeg", data: base64Image } }
            ]
          }]
        })
      }
    );
    const data = await response.json();
    const text = data?.candidates?.[0]?.content?.parts?.[0]?.text || "No food detected.";
    resultDiv.textContent = text;
    const dish = extractDishName(text);
    suggestionDiv.textContent = `Finding nearby restaurants serving ${dish}...`;
    await findNearbyRestaurants(dish);
    generateAIImages(dish);
  } catch (err) {
    resultDiv.textContent = "Error analyzing image.";
    console.error(err);
  }
}

function extractDishName(description) {
  const match = description.match(/(?:dish|called|is|features|showing|of)\s+([A-Za-z\s]+)/i);
  return match ? match[1].trim() : "food";
}

function findNearbyRestaurants(keyword) {
  return new Promise((resolve) => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition((pos) => {
        userLocation = { lat: pos.coords.latitude, lng: pos.coords.longitude };
        map.setCenter(userLocation);
        const req = { location: userLocation, radius: 5000, type: "restaurant", keyword };
        placesService.nearbySearch(req, (results, status) => {
          if (status === google.maps.places.PlacesServiceStatus.OK && results.length) {
            results.forEach((place) => new google.maps.Marker({
              map,
              position: place.geometry.location,
              title: place.name
            }));
            document.getElementById("aiSuggestion").textContent = `Here are restaurants near you serving ${keyword}.`;
          } else {
            document.getElementById("aiSuggestion").textContent = "No nearby restaurants found.";
          }
          resolve();
        });
      }, () => {
        document.getElementById("aiSuggestion").textContent = "Unable to access location.";
        resolve();
      });
    } else {
      document.getElementById("aiSuggestion").textContent = "Geolocation not supported.";
      resolve();
    }
  });
}

function generateAIImages(keyword) {
  const gallery = document.getElementById("foodGallery");
  gallery.innerHTML = "";
  for (let i = 0; i < 5; i++) {
    const img = document.createElement("img");
    const prompt = `professional food photography of ${keyword}, delicious presentation, restaurant plating, vibrant lighting, high quality, 4K, gourmet dish`;
    img.src = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?v=${Math.random()}`;
    gallery.appendChild(img);
  }
}
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places&callback=initMap"></script>
</body>
</html>
